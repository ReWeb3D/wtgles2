var osg={};osg.version="0.1.0";osg.copyright="Cedric Pinson - cedric.pinson@plopbyte.com";osg.log=function(a){window.console!==undefined&&window.console.log(a)};osg.info=function(a){window.console!==undefined&&window.console.info(a)};osg.warn=function(a){window.console!==undefined&&window.console.warn(a)};osg.debug=function(a){window.console!==undefined&&window.console.debug(a)};osg.DEBUG=0;osg.INFO=1;osg.NOTICE=2;osg.WARN=3;
osg.setNotifyLevel=function(a){var b=function(g){window.console!==undefined&&window.console.log(g)},c=function(g){window.console!==undefined&&window.console.info(g)},d=function(g){window.console!==undefined&&window.console.warn(g)},e=function(g){window.console!==undefined&&window.console.debug(g)},f=function(){};osg.debug=f;osg.info=f;osg.log=f;osg.warn=f;if(a<=osg.DEBUG)osg.debug=e;if(a<=osg.INFO)osg.info=c;if(a<=osg.NOTICE)osg.log=b;if(a<=osg.WARN)osg.warn=d};osg.reportWebGLError=false;
osg.init=function(){osg.setNotifyLevel(osg.NOTICE)};osg.isArray=function(a){return toString.call(a)==="[object Array]"};
osg.extend=function(){var a=Object.prototype.toString,b=Object.prototype.hasOwnProperty,c=function(n){return a.call(n)==="[object Function]"},d=osg.isArray,e=function(n){if(!n||a.call(n)!=="[object Object]"||n.nodeType||n.setInterval)return false;if(n.constructor&&!b.call(n,"constructor")&&!b.call(n.constructor.prototype,"isPrototypeOf"))return false;var o;for(o in n);return o===undefined||b.call(n,o)},f=arguments[0]||{},g=1,h=arguments.length,i=false,l,j,k;if(typeof f==="boolean"){i=f;f=arguments[1]||
{};g=2}if(typeof f!=="object"&&!c(f))f={};if(h===g){f=this;--g}for(;g<h;g++)if((c=arguments[g])!==null)for(l in c){j=f[l];k=c[l];if(f!==k)if(i&&k&&(e(k)||d(k))){j=j&&(e(j)||d(j))?j:d(k)?[]:{};f[l]=osg.extend(i,j,k)}else if(k!==undefined)f[l]=k}return f};osg.objectInehrit=function(a,b){function c(){}c.prototype=a;a=new c;b&&osg.objectMix(a,b,false);return a};osg.objectMix=function(a,b,c){for(var d in b)c&&a[d]||(a[d]=b[d]);return a};osg.objectType={};osg.objectType.type=0;
osg.objectType.generate=function(a){var b=osg.objectType.type;osg.objectType[b]=a;osg.objectType[a]=b;osg.objectType.type+=1;return b};osg.Float32Array=Float32Array;osg.Int32Array=Int32Array;osg.Uint16Array=Uint16Array;osgGA={};osg.Vec3={init:function(a){a[0]=0;a[1]=0;a[2]=0;return a},copy:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},cross:function(a,b,c){var d=a[2]*b[0]-a[0]*b[2],e=a[0]*b[1]-a[1]*b[0];c[0]=a[1]*b[2]-a[2]*b[1];c[1]=d;c[2]=e;return c},valid:function(a){if(isNaN(a[0]))return false;if(isNaN(a[1]))return false;if(isNaN(a[2]))return false;return true},mult:function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},length2:function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]},length:function(a){return Math.sqrt(a[0]*
a[0]+a[1]*a[1]+a[2]*a[2])},distance:function(a,b){var c=a[0]-b[0],d=a[1]-b[1];a=a[2]-b[2];return Math.sqrt(c*c+d*d+a*a)},normalize:function(a,b){var c=this.length2(a);if(c>0){c=1/Math.sqrt(c);b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c}else{b[0]=a[0];b[1]=a[1];b[2]=a[2]}return b},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},sub:function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},add:function(a,b,c){c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},neg:function(a,b){b[0]=
-a[0];b[1]=-a[1];b[2]=-a[2];return b},lerp:function(a,b,c,d){d[0]=b[0]+(c[0]-b[0])*a;d[1]=b[1]+(c[1]-b[1])*a;d[2]=b[2]+(c[2]-b[2])*a;return d}};osg.Matrix={_tmp0:[],_tmp1:[],valid:function(a){for(var b=0;b<16;b++)if(isNaN(a[b]))return false;return true},setRow:function(a,b,c,d,e,f){b=b*4;a[b+0]=c;a[b+1]=d;a[b+2]=e;a[b+3]=f},innerProduct:function(a,b,c,d){c=c*4;return a[c+0]*b[0+d]+a[c+1]*b[4+d]+a[c+2]*b[8+d]+a[c+3]*b[12+d]},set:function(a,b,c,d){return a[b*4+c]=d},get:function(a,b,c){return a[b*4+c]},makeIdentity:function(a){if(a===undefined){a=[];osg.log("osg.Matrix.makeIdentity without matrix destination is deprecated")}osg.Matrix.setRow(a,
0,1,0,0,0);osg.Matrix.setRow(a,1,0,1,0,0);osg.Matrix.setRow(a,2,0,0,1,0);osg.Matrix.setRow(a,3,0,0,0,1);return a},makeTranslate:function(a,b,c,d){if(d===undefined)d=[];osg.Matrix.setRow(d,0,1,0,0,0);osg.Matrix.setRow(d,1,0,1,0,0);osg.Matrix.setRow(d,2,0,0,1,0);osg.Matrix.setRow(d,3,a,b,c,1);return d},setTrans:function(a,b,c,d){a[12]=b;a[13]=c;a[14]=d;return a},getTrans:function(a,b){b[0]=a[12];b[1]=a[13];b[2]=a[14];return b},preMult:function(a,b){var c,d,e,f;c=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];
d=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12];e=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12];f=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12];a[0]=c;a[4]=d;a[8]=e;a[12]=f;c=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13];d=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13];e=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13];f=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13];a[1]=c;a[5]=d;a[9]=e;a[13]=f;c=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14];d=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14];e=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14];
f=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14];a[2]=c;a[6]=d;a[10]=e;a[14]=f;c=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15];d=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15];e=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15];f=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15];a[3]=c;a[7]=d;a[11]=e;a[15]=f;return a},postMult:function(a,b){btmp0=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];btmp1=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13];btmp2=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14];btmp3=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+
b[3]*a[15];b[0]=btmp0;b[1]=btmp1;b[2]=btmp2;b[3]=btmp3;btmp0=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12];btmp1=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13];btmp2=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14];btmp3=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15];b[4]=btmp0;b[5]=btmp1;b[6]=btmp2;b[7]=btmp3;btmp0=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12];btmp1=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13];btmp2=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14];btmp3=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15];b[8]=btmp0;b[9]=
btmp1;b[10]=btmp2;b[11]=btmp3;btmp0=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12];btmp1=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13];btmp2=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14];btmp3=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15];b[12]=btmp0;b[13]=btmp1;b[14]=btmp2;b[15]=btmp3;return b},multa:function(a,b,c){if(c===a)return this.preMult(a,b);else if(c===b)return this.postMult(a,b);else{if(c===undefined)c=[];c[0]=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];c[1]=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*
a[13];c[2]=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14];c[3]=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15];c[4]=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12];c[5]=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13];c[6]=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14];c[7]=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15];c[8]=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12];c[9]=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13];c[10]=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14];c[11]=b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15];c[12]=b[12]*a[0]+b[13]*
a[4]+b[14]*a[8]+b[15]*a[12];c[13]=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13];c[14]=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14];c[15]=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15];return c}},mult:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],l=b[6],j=b[7],k=b[8],n=b[9],o=b[10],p=b[11],r=b[12],q=b[13],s=b[14];b=b[15];var t=a[0],u=a[1],v=a[2],w=a[3],x=a[4],y=a[5],z=a[6],A=a[7],E=a[8],B=a[9],C=a[10],D=a[11],m=a[12],F=a[13],G=a[14];a=a[15];c[0]=d*t+e*x+f*E+g*m;c[1]=d*u+e*y+f*B+g*F;
c[2]=d*v+e*z+f*C+g*G;c[3]=d*w+e*A+f*D+g*a;c[4]=h*t+i*x+l*E+j*m;c[5]=h*u+i*y+l*B+j*F;c[6]=h*v+i*z+l*C+j*G;c[7]=h*w+i*A+l*D+j*a;c[8]=k*t+n*x+o*E+p*m;c[9]=k*u+n*y+o*B+p*F;c[10]=k*v+n*z+o*C+p*G;c[11]=k*w+n*A+o*D+p*a;c[12]=r*t+q*x+s*E+b*m;c[13]=r*u+q*y+s*B+b*F;c[14]=r*v+q*z+s*C+b*G;c[15]=r*w+q*A+s*D+b*a;return c},multOrig:function(a,b,c){if(c===a){c=[];for(var d=0;d<4;d++){c[0]=osg.Matrix.innerProduct(b,a,0,d);c[1]=osg.Matrix.innerProduct(b,a,1,d);c[2]=osg.Matrix.innerProduct(b,a,2,d);c[3]=osg.Matrix.innerProduct(b,
a,3,d);a[0+d]=c[0];a[4+d]=c[1];a[8+d]=c[2];a[12+d]=c[3]}return a}else if(c===b){c=[];for(d=0;d<4;d++){c[0]=osg.Matrix.innerProduct(b,a,d,0);c[1]=osg.Matrix.innerProduct(b,a,d,1);c[2]=osg.Matrix.innerProduct(b,a,d,2);c[3]=osg.Matrix.innerProduct(b,a,d,3);this.setRow(b,d,c[0],c[1],c[2],c[3])}return b}if(c===undefined)c=[];d=b[0];var e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],l=b[6],j=b[7],k=b[8],n=b[9],o=b[10],p=b[11],r=b[12],q=b[13],s=b[14];b=b[15];var t=a[0],u=a[1],v=a[2],w=a[3],x=a[4],y=a[5],z=a[6],A=a[7],
E=a[8],B=a[9],C=a[10],D=a[11],m=a[12],F=a[13],G=a[14];a=a[15];c[0]=d*t+e*x+f*E+g*m;c[1]=d*u+e*y+f*B+g*F;c[2]=d*v+e*z+f*C+g*G;c[3]=d*w+e*A+f*D+g*a;c[4]=h*t+i*x+l*E+j*m;c[5]=h*u+i*y+l*B+j*F;c[6]=h*v+i*z+l*C+j*G;c[7]=h*w+i*A+l*D+j*a;c[8]=k*t+n*x+o*E+p*m;c[9]=k*u+n*y+o*B+p*F;c[10]=k*v+n*z+o*C+p*G;c[11]=k*w+n*A+o*D+p*a;c[12]=r*t+q*x+s*E+b*m;c[13]=r*u+q*y+s*B+b*F;c[14]=r*v+q*z+s*C+b*G;c[15]=r*w+q*A+s*D+b*a;return c},makeLookAt:function(a,b,c,d){if(d===undefined)d=[];b=osg.Vec3.sub(b,a,[]);osg.Vec3.normalize(b,
b);c=osg.Vec3.cross(b,c,[]);osg.Vec3.normalize(c,c);var e=osg.Vec3.cross(c,b,[]);osg.Vec3.normalize(e,e);d[0]=c[0];d[1]=e[0];d[2]=-b[0];d[3]=0;d[4]=c[1];d[5]=e[1];d[6]=-b[1];d[7]=0;d[8]=c[2];d[9]=e[2];d[10]=-b[2];d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;osg.Matrix.multTranslate(d,osg.Vec3.neg(a,[]),d);return d},makeOrtho:function(a,b,c,d,e,f,g){if(g===undefined)g=[];var h=-(b+a)/(b-a),i=-(d+c)/(d-c),l=-(f+e)/(f-e),j=osg.Matrix.setRow;j(g,0,2/(b-a),0,0,0);j(g,1,0,2/(d-c),0,0);j(g,2,0,0,-2/(f-e),0);
j(g,3,h,i,l,1);return g},getLookAt:function(a,b,c,d,e){if(e===undefined)e=1;var f=[];osg.Matrix.inverse(a,f)||osg.Matrix.makeIdentity(f);osg.Matrix.transformVec3(f,[0,0,0],b);osg.Matrix.transform3x3(a,[0,1,0],d);osg.Matrix.transform3x3(a,[0,0,-1],c);osg.Vec3.normalize(c,c);osg.Vec3.add(osg.Vec3.mult(c,e,[]),b,c)},getRotate:function(a,b){if(b===undefined)b=[];var c=[],d,e;d=a[0];e=a[5];var f=a[10];c[0]=1+d+e+f;c[1]=1+d-e-f;c[2]=1-d+e-f;c[3]=1-d-e+f;e=0;for(d=1;d<4;d++)e=c[d]>c[e]?d:e;if(e===0){b[3]=
c[0];b[0]=a[6]-a[9];b[1]=a[8]-a[2];b[2]=a[1]-a[4]}else if(e==1){b[3]=a[6]-a[9];b[0]=c[1];b[1]=a[1]+a[4];b[2]=a[8]+a[2]}else if(e==2){b[3]=a[8]-a[2];b[0]=a[1]+a[4];b[1]=c[2];b[2]=a[6]+a[9]}else{b[3]=a[1]-a[4];b[0]=a[8]+a[2];b[1]=a[6]+a[9];b[2]=c[3]}a=Math.sqrt(0.25/c[e]);b[3]*=a;b[0]*=a;b[1]*=a;b[2]*=a;return b},preMultTranslate:function(a,b){if(b[0]!==0){val=b[0];a[12]+=val*a[0];a[13]+=val*a[1];a[14]+=val*a[2];a[15]+=val*a[3]}if(b[1]!==0){val=b[1];a[12]+=val*a[4];a[13]+=val*a[5];a[14]+=val*a[6];a[15]+=
val*a[7]}if(b[2]!==0){val=b[2];a[12]+=val*a[8];a[13]+=val*a[9];a[14]+=val*a[10];a[15]+=val*a[11]}return a},multTranslate:function(a,b,c){if(c===undefined)c=[];c!==a&&osg.Matrix.copy(a,c);var d;if(b[0]!==0){d=b[0];c[12]+=d*a[0];c[13]+=d*a[1];c[14]+=d*a[2];c[15]+=d*a[3]}if(b[1]!==0){d=b[1];c[12]+=d*a[4];c[13]+=d*a[5];c[14]+=d*a[6];c[15]+=d*a[7]}if(b[2]!==0){d=b[2];c[12]+=d*a[8];c[13]+=d*a[9];c[14]+=d*a[10];c[15]+=d*a[11]}return c},makeRotate:function(a,b,c,d,e){if(e===undefined){osg.log("osg.makeRotate without given matrix destination is deprecated");
e=[]}var f=Math.sqrt(b*b+c*c+d*d),g=Math.sin(a);a=Math.cos(a);if(f>0){var h,i,l,j,k;f=1/f;b*=f;c*=f;d*=f;f=b*b;h=c*c;i=d*d;l=b*c;j=c*d;k=d*b;b=b*g;c=c*g;d=d*g;g=1-a;e[0]=g*f+a;e[1]=g*l-d;e[2]=g*k+c;e[3]=0;e[4]=g*l+d;e[5]=g*h+a;e[6]=g*j-b;e[7]=0;e[8]=g*k-c;e[9]=g*j+b;e[10]=g*i+a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}else return osg.Matrix.makeIdentity(e)},transform3x3:function(a,b,c){if(c===undefined)c=[];c[0]=a[0]*b[0]+a[1]*b[1]+a[2]*b[2];c[1]=a[4]*b[0]+a[5]*b[1]+a[6]*b[2];c[2]=a[8]*b[0]+
a[9]*b[1]+a[10]*b[2];return c},transformVec3:function(a,b,c){var d=1/(a[3]*b[0]+a[7]*b[1]+a[11]*b[2]+a[15]);if(c===undefined)c=[];var e;e=c===b?[]:c;e[0]=(a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12])*d;e[1]=(a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+a[13])*d;e[2]=(a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14])*d;c===b&&osg.Vec3.copy(e,c);return c},transformVec4:function(a,b,c){if(c===undefined)c=[];var d;d=c===b?[]:c;d[0]=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];d[1]=a[4]*b[0]+a[5]*b[1]+a[6]*b[2]+a[7]*b[3];d[2]=a[8]*b[0]+a[9]*
b[1]+a[10]*b[2]+a[11]*b[3];d[3]=a[12]*b[0]+a[13]*b[1]+a[14]*b[2]+a[15]*b[3];c===b&&osg.Vec4.copy(d,c);return c},copy:function(a,b){if(b===undefined)b=[];b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},inverse:function(a,b){if(b===a){osg.Matrix.copy(a,osg.Matrix._tmp1);a=osg.Matrix._tmp1}return a[3]===0&&a[7]===0&&a[11]===0&&a[15]===1?this.inverse4x3(a,b):this.inverse4x4(a,
b)},inverse4x4:function(a,b){var c=a[10]*a[15],d=a[14]*a[11],e=a[6]*a[15],f=a[14]*a[7],g=a[6]*a[11],h=a[10]*a[7],i=a[2]*a[15],l=a[14]*a[3],j=a[2]*a[11],k=a[10]*a[3],n=a[2]*a[7],o=a[6]*a[3],p=a[8]*a[13],r=a[12]*a[9],q=a[4]*a[13],s=a[12]*a[5],t=a[4]*a[9],u=a[8]*a[5],v=a[0]*a[13],w=a[12]*a[1],x=a[0]*a[9],y=a[8]*a[1],z=a[0]*a[5],A=a[4]*a[1],E=c*a[5]+f*a[9]+g*a[13]-(d*a[5]+e*a[9]+h*a[13]),B=d*a[1]+i*a[9]+k*a[13]-(c*a[1]+l*a[9]+j*a[13]),C=e*a[1]+l*a[5]+n*a[13]-(f*a[1]+i*a[5]+o*a[13]),D=h*a[1]+j*a[5]+o*
a[9]-(g*a[1]+k*a[5]+n*a[9]),m=a[0]*E+a[4]*B+a[8]*C+a[12]*D;if(Math.abs(m)<1.0E-5){osg.log("Warning can't inverse matrix "+a);return false}m=1/m;B=m*B;C=m*C;D=m*D;var F=m*(d*a[4]+e*a[8]+h*a[12]-(c*a[4]+f*a[8]+g*a[12]));c=m*(c*a[0]+l*a[8]+j*a[12]-(d*a[0]+i*a[8]+k*a[12]));e=m*(f*a[0]+i*a[4]+o*a[12]-(e*a[0]+l*a[4]+n*a[12]));g=m*(g*a[0]+k*a[4]+n*a[8]-(h*a[0]+j*a[4]+o*a[8]));h=m*(p*a[7]+s*a[11]+t*a[15]-(r*a[7]+q*a[11]+u*a[15]));j=m*(r*a[3]+v*a[11]+y*a[15]-(p*a[3]+w*a[11]+x*a[15]));k=m*(q*a[3]+w*a[7]+z*
a[15]-(s*a[3]+v*a[7]+A*a[15]));n=m*(u*a[3]+x*a[7]+A*a[11]-(t*a[3]+y*a[7]+z*a[11]));o=m*(q*a[10]+u*a[14]+r*a[6]-(t*a[14]+p*a[6]+s*a[10]));p=m*(x*a[14]+p*a[2]+w*a[10]-(v*a[10]+y*a[14]+r*a[2]));q=m*(v*a[6]+A*a[14]+s*a[2]-(z*a[14]+q*a[2]+w*a[6]));a=m*(z*a[10]+t*a[2]+y*a[6]-(x*a[6]+A*a[10]+u*a[2]));b[0]=m*E;b[1]=B;b[2]=C;b[3]=D;b[4]=F;b[5]=c;b[6]=e;b[7]=g;b[8]=h;b[9]=j;b[10]=k;b[11]=n;b[12]=o;b[13]=p;b[14]=q;b[15]=a;return true},inverse4x3:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=
a[8],l=a[9],j=a[10];b[0]=g*j-h*l;b[1]=e*l-d*j;b[2]=d*h-e*g;var k=1/(c*b[0]+f*b[1]+i*b[2]);c*=k;f*=k;i*=k;b[0]*=k;b[1]*=k;b[2]*=k;b[3]=0;b[4]=h*i-f*j;b[5]=c*j-e*i;b[6]=e*f-c*h;b[7]=0;b[8]=f*l-g*i;b[9]=d*i-c*l;b[10]=c*g-d*f;b[11]=0;b[15]=1;c=a[15];d=c-1;if(d*d>1.0E-6){d=osg.Matrix._tmp0;b[12]=b[13]=b[14]=0;g=a[3];h=a[7];i=a[11];e=b[0]*g+b[1]*h+b[2]*i;f=b[4]*g+b[5]*h+b[6]*i;i=b[8]*g+b[9]*h+b[10]*i;g=a[12];h=a[13];a=a[14];c=1/(c-(g*e+h*f+a*i));g*=c;h*=c;a*=c;d[0]=g*e+1;d[1]=h*e;d[2]=a*e;d[3]=-e*c;d[4]=
g*f;d[5]=h*f+1;d[6]=a*f;d[7]=-f*c;d[8]=g*i;d[9]=h*i;d[10]=a*i+1;d[11]=-i*c;d[12]=-g;d[13]=-h;d[14]=-a;d[15]=c;osg.Matrix.preMult(b,d)}else{g=a[12];h=a[13];a=a[14];b[12]=-(g*b[0]+h*b[4]+a*b[8]);b[13]=-(g*b[1]+h*b[5]+a*b[9]);b[14]=-(g*b[2]+h*b[6]+a*b[10])}return true},transpose:function(a,b){if(a===b){b=a[1];var c=a[2],d=a[3],e=a[6],f=a[7],g=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=b;a[6]=a[9];a[7]=a[13];a[8]=c;a[9]=e;a[11]=a[14];a[12]=d;a[13]=f;a[14]=g;return a}else{b[0]=a[0];b[1]=a[4];b[2]=a[8];
b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b}},makePerspective:function(a,b,c,d,e){if(e===undefined)e=[];a=c*Math.tan(a*Math.PI/360);var f=-a;return osg.Matrix.makeFrustum(f*b,a*b,f,a,c,d,e)},makeScale:function(a,b,c,d){if(d===undefined)d=[];this.setRow(d,0,a,0,0,0);this.setRow(d,1,0,b,0,0);this.setRow(d,2,0,0,c,0);this.setRow(d,3,0,0,0,1);return d},makeFrustum:function(a,b,c,d,e,f,g){if(g===
undefined)g=[];var h=2*e/(d-c),i=(b+a)/(b-a);c=(d+c)/(d-c);d=-(f+e)/(f-e);f=-2*f*e/(f-e);this.setRow(g,0,2*e/(b-a),0,0,0);this.setRow(g,1,0,h,0,0);this.setRow(g,2,i,c,d,-1);this.setRow(g,3,0,0,f,0);return g},makeRotateFromQuat:function(a,b){this.makeIdentity(b);return this.setRotateFromQuat(b,a)},setRotateFromQuat:function(a,b){var c=osg.Quat.length2(b);if(Math.abs(c)<=Number.MIN_VALUE){a[0]=0;a[1]=0;a[2]=0;a[4]=0;a[5]=0;a[6]=0;a[8]=0;a[9]=0;a[10]=0}else{c=c!==1?2/c:2;var d,e,f,g,h,i,l,j;d=c*b[0];
e=c*b[1];j=c*b[2];c=b[0]*d;h=b[0]*e;i=b[0]*j;f=b[1]*e;g=b[1]*j;l=b[2]*j;d=b[3]*d;e=b[3]*e;b=b[3]*j;a[0]=1-(f+l);a[4]=h-b;a[8]=i+e;a[1]=h+b;a[5]=1-(c+l);a[9]=g-d;a[2]=i-e;a[6]=g+d;a[10]=1-(c+f)}return a}};osgGA.Manipulator=function(){this._touches=[];this._inverseMatrix=new Array(16);osg.Matrix.makeIdentity(this._inverseMatrix)};
osgGA.Manipulator.prototype={getPositionRelativeToCanvas:function(a){var b=a.target,c,d;if(a.pageX||a.pageY){c=a.pageX;d=a.pageY}else if(a.clientX||a.clientY){c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;d=a.clientY+document.body.scrollTop+document.documentElement.scrollTop}a=function(e){var f=0,g=0;f=e.offsetLeft;g=e.offsetTop;for(var h=document.getElementsByTagName("body")[0];e.offsetParent&&e!=h;){f+=e.offsetParent.offsetLeft;g+=e.offsetParent.offsetTop;e=e.offsetParent}return[f,
g]}(b);c-=a[0];d=b.height-(d-a[1]);return[c,d]},EaseOutQuad:function(a){return-(a*(a-2))},keydown:function(){},keyup:function(){},mouseup:function(){},mousedown:function(){},mousemove:function(){},dblclick:function(){},touchstart:function(a){a.preventDefault();a=a.changedTouches;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.identifier;this._touches[e]=d;d=this.getPositionRelativeToCanvas(d);osg.debug("touch "+e+" started at "+d[0]+" "+d[1])}},touchend:function(a){a.preventDefault();a=a.changedTouches;
for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.identifier;this._touches[e]=undefined;d=this.getPositionRelativeToCanvas(d);osg.debug("touch "+e+" stoped at "+d[0]+" "+d[1])}},touchmove:function(a){a.preventDefault();a=a.changedTouches;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.identifier,f=this.getPositionRelativeToCanvas(d),g=this.getPositionRelativeToCanvas(this._touches[e]),h=f[0]-g[0];f=f[1]-g[1];this._touches[e]=d;osg.debug("touch "+e+" moved "+h+" "+f)}},touchleave:function(a){return this.touchend(a)},
touchcancel:function(a){a.preventDefault();a=a.changedTouches;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.identifier;this._touches[e]=undefined;d=this.getPositionRelativeToCanvas(d);osg.debug("touch "+e+" cancelled at "+d[0]+" "+d[1])}},gesturestart:function(a){a.preventDefault();osg.debug("gesturestart  scale "+a.scale+" rotation "+a.rotation)},gestureend:function(a){a.preventDefault();osg.debug("gestureend  scale "+a.scale+" rotation "+a.rotation)},gesturechange:function(a){a.preventDefault();
osg.debug("gesturechange scale "+a.scale+" rotation "+a.rotation)},mousewheel:function(a,b,c,d){a.preventDefault();osg.debug("mousewheel "+b+"  "+c+" "+d)},update:function(){},getInverseMatrix:function(){return this._inverseMatrix}};osgGA.FirstPersonManipulator=function(){osgGA.Manipulator.call(this);this.init()};
osgGA.FirstPersonManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{setNode:function(a){this._node=a},init:function(){this._direction=[0,1,0];this._angleHorizontal=this._angleVertical=0;this._eye=[0,25,10];this._up=[0,0,1];this._buttonup=true;this._radius=1;this._forward=new osgGA.OrbitManipulator.Interpolator(1);this._side=new osgGA.OrbitManipulator.Interpolator(1);this._lookPosition=new osgGA.OrbitManipulator.Interpolator(2);this._stepFactor=1;this._target=new Array(3);osg.Vec3.init(this._target)},
reset:function(){this.init()},getEyePosition:function(a){a[0]=this._eye[0];a[1]=this._eye[1];a[2]=this._eye[2];return a},setEyePosition:function(a){this._eye[0]=a[0];this._eye[1]=a[1];this._eye[2]=a[2]},getTarget:function(a,b){if(b===undefined)b=25;b=osg.Vec3.mult(this._direction,b,new Array(3));osg.Vec3.add(this._eye,b,a)},setTarget:function(a){this._target[0]=a[0];this._target[1]=a[1];this._target[2]=a[2];var b=new Array(3);osg.Vec3.sub(a,this._eye,b);b[2]=0;osg.Vec3.normalize(b,b);this._angleHorizontal=
Math.acos(b[1]);if(b[0]<0)this._angleHorizontal=-this._angleHorizontal;osg.Vec3.sub(a,this._eye,b);osg.Vec3.normalize(b,b);this._angleVertical=-Math.asin(b[2]);osg.Vec3.copy(b,this._direction)},mousedown:function(a){a=this.getPositionRelativeToCanvas(a);this._lookPosition.set(a[0],a[1]);this._buttonup=false},mouseup:function(){this._buttonup=true},mousemove:function(a){if(this._buttonup!==true){a=this.getPositionRelativeToCanvas(a);this._lookPosition.setTarget(a[0],a[1])}},computeRotation:function(a,
b){this._angleVertical+=b*0.01;this._angleHorizontal-=a*0.01;a=[];b=[];var c=[];osg.Matrix.makeRotate(this._angleVertical,1,0,0,a);osg.Matrix.makeRotate(this._angleHorizontal,0,0,1,b);osg.Matrix.mult(b,a,c);this._direction=osg.Matrix.transformVec3(c,[0,1,0],[]);osg.Vec3.normalize(this._direction,this._direction);this._up=osg.Matrix.transformVec3(c,[0,0,1],[])},mousewheel:function(a,b){a.preventDefault();this._stepFactor=Math.min(Math.max(0.001,this._stepFactor+b*0.01),4)},update:function(a){var b=
a.getFrameStamp().getSimulationTime();if(this._lastUpdate===undefined)this._lastUpdate=b;a=b-this._lastUpdate;this._lastUpdate=b;this._forward.update();this._side.update();b=this._lookPosition.update();this.computeRotation(-b[0]*0.5,-b[1]*0.5);b=new Array(2);b[0]=this._forward.getCurrent()[0];b[1]=this._side.getCurrent()[0];osg.Vec2.length(b)>1&&osg.Vec2.normalize(b,b);var c=this._radius;if(this._radius<0.001)c=1;this.moveForward(b[0]*c*this._stepFactor*a);this.strafe(b[1]*c*this._stepFactor*a);this._target=
a=osg.Vec3.add(this._eye,this._direction,[]);osg.Matrix.makeLookAt(this._eye,a,this._up,this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix},moveForward:function(a){a=osg.Vec3.mult(osg.Vec3.normalize(this._direction,[]),a,[]);this._eye=osg.Vec3.add(this._eye,a,[])},strafe:function(a){var b=osg.Vec3.cross(this._direction,this._up,[]);a=osg.Vec3.mult(osg.Vec3.normalize(b,b),a,[]);this._eye=osg.Vec3.add(this._eye,a,[])},keydown:function(a){if(a.keyCode===32)this.computeHomePosition();
else if(a.keyCode===87||a.keyCode===90||a.keyCode===38){this._forward.setTarget(1);return false}else if(a.keyCode===83||a.keyCode===40){this._forward.setTarget(-1);return false}else if(a.keyCode===68||a.keyCode===39){this._side.setTarget(1);return false}else if(a.keyCode===65||a.keyCode===81||a.keyCode===37){this._side.setTarget(-1);return false}},keyup:function(a){if(a.keyCode===87||a.keyCode===90||a.keyCode===38){this._forward.setTarget(0);return false}else if(a.keyCode==83||a.keyCode===40){this._forward.setTarget(0);
return false}else if(a.keyCode==68||a.keyCode===39){this._side.setTarget(0);return false}else if(a.keyCode===65||a.keyCode===81||a.keyCode===37){this._side.setTarget(0);return false}}});osgGA.OrbitManipulator=function(){osgGA.Manipulator.call(this);this.init()};osgGA.OrbitManipulator.Rotate=0;osgGA.OrbitManipulator.Pan=1;osgGA.OrbitManipulator.Zoom=2;osgGA.OrbitManipulator.Interpolator=function(a,b){this._current=new Array(a);this._target=new Array(a);this._delta=new Array(a);this._delay=b;if(this._delay===undefined)this._delay=0.15;this._reset=false;this.reset()};
osgGA.OrbitManipulator.Interpolator.prototype={reset:function(){for(var a=0,b=this._current.length;a<b;a++)this._current[a]=this._target[a]=0;this._reset=true},update:function(){for(var a=0,b=this._current.length;a<b;a++){var c=(this._target[a]-this._current[a])*this._delay;this._delta[a]=c;this._current[a]+=c}return this._delta},set:function(){for(var a=0,b=this._current.length;a<b;a++)this._current[a]=this._target[a]=arguments[a];this._reset=false},isReset:function(){return this._reset},getCurrent:function(){return this._current},
setTarget:function(){for(var a=0,b=this._target.length;a<b;a++)this._target[a]=this._reset?(this._current[a]=arguments[a]):arguments[a];this._reset=false},getTarget:function(){return this._target},getDelta:function(){return this._delta}};
osgGA.OrbitManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{init:function(){this._distance=25;this._target=new Array(3);osg.Vec3.init(this._target);this.earthRadius=635E4;this._rotation=osg.Matrix.makeIdentity([]);this._rotAngleTheta=this._time=0;this._rotate=new osgGA.OrbitManipulator.Interpolator(2);this._pan=new osgGA.OrbitManipulator.Interpolator(2);this._zoom=new osgGA.OrbitManipulator.Interpolator(1);this._zoom.reset=function(){osgGA.OrbitManipulator.Interpolator.prototype.reset.call(this);
this._start=0};this._buttonup=true;this._scale=10;this._currentMode=undefined;this._minDistance=this._maxDistance=0;this._scaleMouseMotion=0.1;this._moveTouch=this._node=undefined;this._inverseMatrix=new Array(16);this._rotateKey=65;this._zoomKey=83;this._panKey=68},reset:function(){this.init()},setNode:function(a){this._node=a},setTarget:function(a){osg.Vec3.copy(a,this._target);var b=new Array(3);this.getEyePosition(b);this._distance=osg.Vec3.distance(b,a)},setEyePosition:function(a){this._eye=
a;var b=this._rotation,c=this._target,d=this._up,e=osg.Vec3.sub(a,c,[]);osg.Vec3.normalize(e,e);d=osg.Vec3.cross(e,d,[]);osg.Vec3.normalize(d,d);var f=osg.Vec3.cross(d,e,[]);osg.Vec3.normalize(f,f);b[0]=d[0];b[1]=e[0];b[2]=f[0];b[3]=0;b[4]=d[1];b[5]=e[1];b[6]=f[1];b[7]=0;b[8]=d[2];b[9]=e[2];b[10]=f[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;this._distance=osg.Vec3.distance(a,c)},setLookFromToUp:function(a,b,c){this.init();this._distance=25;this._target=b;this._up=c;this.setEyePosition(a)},keydown:function(a){if(a.keyCode!==
32)if(a.keyCode===33)this.distanceIncrease();else if(a.keyCode===34)this.distanceDecrease();else if(a.keyCode===this._panKey&&this._currentMode!==osgGA.OrbitManipulator.Pan){this._currentMode=osgGA.OrbitManipulator.Pan;this._pan.reset();this.pushButton();a.preventDefault()}else if(a.keyCode===this._zoomKey&&this._currentMode!==osgGA.OrbitManipulator.Zoom){this._currentMode=osgGA.OrbitManipulator.Zoom;this._zoom.reset();this.pushButton();a.preventDefault()}else if(a.keyCode===this._rotateKey&&this._currentMode!==
osgGA.OrbitManipulator.Rotate){this._currentMode=osgGA.OrbitManipulator.Rotate;this._rotate.reset();this.pushButton();a.preventDefault()}},keyup:function(a){if(a.keyCode===this._panKey)this.mouseup(a);else if(a.keyCode===this._rotateKey)this.mouseup(a);else a.keyCode===this._rotateKey&&this.mouseup(a);this._currentMode=undefined},touchstart:function(a){if(this._currentMode===undefined)this._currentMode=osgGA.OrbitManipulator.Rotate;var b=a.changedTouches;if(this._moveTouch===undefined)this._moveTouch=
new osgGA.OrbitManipulator.TouchEvent;if(this._moveTouch.id===undefined){b=b[0];var c=b.identifier,d=this.getPositionRelativeToCanvas(b);this._rotate.set(d[0],d[1]);this._moveTouch.init(c,d[0],d[1]);this.pushButton(b)}a.preventDefault()},touchend:function(a){a.preventDefault();this._moveTouch=this._currentMode=undefined;this.releaseButton(a)},touchmove:function(a){a.preventDefault();a=a.changedTouches;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.identifier;if(e===this._moveTouch.id){d=this.getPositionRelativeToCanvas(d);
this._rotate.setTarget(d[0],d[1]);this._moveTouch.init(e,d[0],d[1])}}},touchleave:function(a){return this.touchend(a)},touchcancel:function(a){this.touchend(a)},gesturestart:function(a){a.preventDefault();if(this._moveTouch)this._moveTouch.id=undefined;this._moveTouch.init(undefined,0,0,a.scale,a.rotation);this._zoom.reset()},gestureend:function(a){a.preventDefault();this._moveTouch.init(undefined,0,0,a.scale,a.rotation);this._currentMode=undefined},gesturechange:function(a){a.preventDefault();var b=
(a.scale-this._moveTouch.scale)*5;this._moveTouch.init(undefined,0,0,a.scale,a.rotation);this._zoom.setTarget(this._zoom.getTarget()[0]-b)},mouseup:function(a){this.releaseButton(a);this._currentMode=undefined},mousedown:function(a){if(this._currentMode===undefined)this._currentMode=a.button===0?a.shiftKey?osgGA.OrbitManipulator.Pan:a.ctrlKey?osgGA.OrbitManipulator.Zoom:osgGA.OrbitManipulator.Rotate:osgGA.OrbitManipulator.Pan;this.pushButton(a);var b=this.getPositionRelativeToCanvas(a);if(this._currentMode===
osgGA.OrbitManipulator.Rotate){this._rotate.reset(b[0],b[1]);this._rotate.set(b[0],b[1])}else if(this._currentMode===osgGA.OrbitManipulator.Pan){this._pan.reset(b[0],b[1]);this._pan.set(b[0],b[1])}else if(this._currentMode===osgGA.OrbitManipulator.Zoom){this._zoom._start=b[1];this._zoom.set(0)}a.preventDefault()},mousemove:function(a){if(this._buttonup!==true){var b=this.getPositionRelativeToCanvas(a);if(isNaN(b[0])===false&&isNaN(b[1])===false)if(this._currentMode===osgGA.OrbitManipulator.Rotate)this._rotate.setTarget(b[0],
b[1]);else if(this._currentMode===osgGA.OrbitManipulator.Pan)this._pan.setTarget(b[0],b[1]);else if(this._currentMode===osgGA.OrbitManipulator.Zoom){if(this._zoom.isReset()){this._zoom._start=b[1];this._zoom.set(0)}var c=b[1]-this._zoom._start;this._zoom._start=b[1];b=this._zoom.getTarget()[0];var d=this._distance-this.earthRadius;d=1;this._zoom.setTarget(b-c*d)}a.preventDefault();a.preventDefault()}},setMaxDistance:function(a){this._maxDistance=a},setMinDistance:function(a){this._minDistance=a},
setDistance:function(a){this._distance=a},getDistance:function(){return this._distance},computePan:function(a,b){b*=this._distance;a*=this._distance;var c=new Array(16),d=new Array(3),e=new Array(3);osg.Matrix.inverse(this._rotation,c);d[0]=osg.Matrix.get(c,0,0);d[1]=osg.Matrix.get(c,0,1);d[2]=osg.Matrix.get(c,0,2);osg.Vec3.normalize(d,d);e[0]=osg.Matrix.get(c,2,0);e[1]=osg.Matrix.get(c,2,1);e[2]=osg.Matrix.get(c,2,2);osg.Vec3.normalize(e,e);osg.Vec3.mult(d,-a,d);osg.Vec3.mult(e,b,e);osg.Vec3.add(this._target,
d,this._target);osg.Vec3.add(this._target,e,this._target)},computeRotation:function(a,b){var c=this._distance-this.earthRadius;c=this._scaleMouseMotion;var d=osg.Matrix.makeRotate(c*a,this._up[0],this._up[1],this._up[2],[]);a=osg.Matrix.mult(this._rotation,d,[]);d=osg.Vec3.cross(osg.Vec3.normalize(osg.Vec3.sub(this._target,this._eye,[]),[]),this._up,[]);d=osg.Vec3.normalize(d,d);osg.Matrix.makeRotate(c*b,d[0],d[1],d[2],[]);if(Math.abs(this._rotAngleTheta+c*b)<0.5*Math.PI*0.98){this._rotAngleTheta+=
c*b;d=osg.Matrix.makeRotate(c*b,d[0],d[1],d[2],[]);a=osg.Matrix.mult(d,a,[])}this._rotation=a},releaseButton:function(){this._buttonup=true},mousewheel:function(a,b){a.preventDefault();a=this._distance-this.earthRadius;a=this._scaleMouseMotion*10;b=a*b;if(b<-10)b=-10;if(b>10)b=10;this._zoom.setTarget(this._zoom.getTarget()[0]-b)},computeZoom:function(a){this.zoom(a)},zoom:function(a){a=this._distance*a;if(this._minDistance>0)if(a<this._minDistance)a=this._minDistance;if(this._maxDistance>0)if(a>this._maxDistance)a=
this._maxDistance;this._distance=a},pushButton:function(){this._buttonup=false},getTarget:function(a){osg.Vec3.copy(this._target,a)},getEyePosition:function(a){var b=new Array(16);osg.Matrix.inverse(this._rotation,b);osg.Matrix.transformVec3(b,[0,this._distance,0],a);osg.Vec3.add(this._target,a,a)},update:function(a){if(this._lastUpdate===undefined)this._lastUpdate=a;this._lastUpdate=a;a=this._rotate.update();this.computeRotation(-a[0]*0.1,-a[1]*0.1);a=this._pan.update();this.computePan(-a[0]*0.002,
-a[1]*0.002);a=this._zoom.update();this.computeZoom(1+a[0]/10);a=this._target;var b=this._distance,c=new Array(3);osg.Matrix.inverse(this._rotation,this._inverseMatrix);osg.Matrix.transformVec3(this._inverseMatrix,[0,b,0],c);osg.Matrix.makeLookAt(osg.Vec3.add(a,c,c),a,this._up,this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix}});osgGA.OrbitManipulator.TouchEvent=function(){this.y=this.x=0;this.scale=1;this.rotation=0;this.id=undefined};
osgGA.OrbitManipulator.TouchEvent.prototype={init:function(a,b,c,d,e){this.id=a;this.x=b;this.y=c;if(d!==undefined)this.scale=d;if(e!==undefined)this.rotation=e}};
